---
import { getCourses } from '../lib/notion.js';
import { supabase } from '../lib/supabase.js';

const courses = await getCourses();

const { data: sessionData, error: sessionError } = await supabase.auth.getSession();
---
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <title>课程列表</title>
    <script type="module" is:inline>
      import('/src/lib/sentry.client.js');
    </script>
  </head>
  <body>
    <div class="min-h-screen bg-gray-50 text-gray-800 p-8">
      <h1 class="text-3xl font-bold mb-6">课程列表</h1>
      <ul class="space-y-4">
        {courses.map((course) => (
          <li key={course.id} class="bg-white shadow rounded-lg p-4">
            <strong>{course.title}</strong><br />
            类别：{course.category}  |  价格：¥{course.price}
          </li>
        ))}
      </ul>
    </div>
    <div class="mt-10 p-4 bg-yellow-100 border border-yellow-300 rounded">
      <h2 class="font-semibold text-lg mb-2">[Supabase 连接测试]</h2>
      {sessionError ? (
        <p class="text-red-600">出错了：{sessionError.message}</p>
      ) : (
        <p class="text-green-700">当前用户：{sessionData.session?.user?.email ?? '未登录'}</p>
      )}
    </div>
    <div class="mt-10 p-4 bg-red-100 border border-red-300 rounded">
      <h2 class="font-semibold text-lg mb-2">[Sentry 客户端错误测试]</h2>
      <button onclick="throw new TypeError('这是一个测试 TypeError 错误')" class="px-4 py-2 bg-red-600 text-white rounded">
        触发 TypeError
      </button>
    </div>
  </body>
</html>